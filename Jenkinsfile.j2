env.ENV_BUILDNAME="DEV"
env.dpeClFoTag="Development"
env.dpeClFoBuildDate="TimeStamp"

pipeline {
    agent {
        docker {
            image 'envolve-innovation-labs/eil-cibuild-nodejs:sre-1.0.9-2019.07.23'
            args '-u root  -v /var/run/docker.sock:/var/run/docker.sock'
        }
    }
    environment {
        dev = 'true'
    }
    stages {

        stage('Prepare Build Info') {
                 steps {
                   script{
                      def now = new Date()
                      def buildDisplayName = "${now.format("yyyyMMdd", TimeZone.getTimeZone('America/New_York'))}:${BUILD_NUMBER}"
                      currentBuild.displayName = buildDisplayName
                      env.ENV_BUILDNAME=buildDisplayName
                      env.dpeClFoTag=sh script: "$(git describe)", returnStdout: true
                      env.dpeClFoBuildDate=sh script: "$(TZ='EST5EDT,M3.2.0,M11.1.0' date)", returnStdout: true
                   }
                 }
           }

        stage('Deploy Some Client Foundation') {
            steps{
                sh '''
                    echo "start deploy dpe-client-foundation"

                    dpeBuildTag=$ENV_BUILDNAME
                    echo $dpeClFoTag 
                     echo $dpeClFoBuildDate
                    echo "'{"buildNumber": $dpeBuildTag, "tag": $dpeClFoTag, "buildDate": $dpeClFoBuildDate }'" > storybook-dist/build-date.json
                '''
            }
        }
    }
}
